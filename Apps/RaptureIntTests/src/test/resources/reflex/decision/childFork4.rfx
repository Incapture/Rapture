/**
 * Copyright (C) 2011-2013 Incapture Technologies LLC
 *
 * This is an autogenerated license statement. When copyright notices appear below
 * this one that copyright supercedes this statement.
 *
 * Unless required by applicable law or agreed to in writing, software is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied.
 *
 * Unless explicit permission obtained in writing this software cannot be distributed.
 */

// init the params we pass in
//if !defined(_params) do
//	_params = {};
//	_params['workflowURI'] =  '';
//    _params['caller'] =  'LOCAL';    
//end    
println('******* IN FORK CHILD STEP 4 *******');

workerURI =  _params['$DP_WORKER_URI'];
workOrderURI = _params['$DP_WORK_ORDER_URI'];
println('******* DP_WORKER_URI    : ' + workerURI);
println('******* DP_WORK_ORDER_URI: ' + workOrderURI);

workOrderStatus = #decision.getWorkOrderStatus(workOrderURI);
println("******* Status is        : " + workOrderStatus);

//get doc repo uri and write a doc to it.
docRepo = #decision.getContextValue(workerURI,'docRepoUri');
println('******* Doc Repo Uri is  : ' + docRepo);
jsonStr = "{\"KeyFromChild4\":\"ValueFromChild4\"}";
x = #decision.getContextValue(workerURI,'randomNumber');
docUri = docRepo +  x + '/' + 'docFromFork4'; //create unique document uri
println('******* Writing ' + jsonStr + ' to ' + docUri); 
#doc.putDoc(docUri, jsonStr);

return "ok";
